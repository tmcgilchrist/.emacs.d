require 'test/unit'
require 'dhaka/runtime'
require 'dice_grammar'
require 'dice_parser'
require 'dice_evaluator'
require 'dice_lexer_specification'
require 'dice_lexer'

class TestDice < Test::Unit::TestCase
  def test_parses_dice_expressions
    assert_equal -7, evaluate("5-2d6")
    assert_equal 4.5, evaluate("5-10 / 2d5 /2")
    assert_equal 11, evaluate("5- (1 -2 )d6")
    assert_equal 32, evaluate("(2d3)d6-4")
    assert_equal 0, evaluate("(2*3) - d6")
  end
  
  def evaluate(input)
    DiceEvaluator.new.evaluate(DiceParser.parse(DiceLexer.lex(input)))
  end
