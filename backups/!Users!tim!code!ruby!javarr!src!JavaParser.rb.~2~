#!/usr/bin/env ruby -wKU

require "strscan"

class JavaParser

  AST = Struct.new(:value)

  def parse(input)
    @input = StringScanner.new(input)
    parse_value.value
  ensure
    @input.eos? or error("Unexpected data")
  end

  private

  def parse_value
    trim_space
    parse_singleline_comment or
    parse_multiline_comment or
    error("Illegal Java value")
  ensure
    trim_space
  end

  def parse_singleline_comment
    if @input.scan(/\/\//)
      #grab all 
      comment = @input.scan(/[\w\s]*$/)
      AST.new("//"+comment)
    else
      false
    end
  end

  def parse_multiline_comment
    str = @input.scan(/\/\*/)
    if str
        if s = @input.scan_until(/\*\//)
          str = str + s
          AST.new(str)
        else 
          error("Unclosed comment")
        end
    else
      false
    end
  end

  def trim_space
    @input.scan(/\s+/)
  end
  
  def error(message)
    if @input.eos?
      raise "Unexpected end of input."
    else
      raise "#{message}:  #{@input.peek(@input.string.length)}"
    end
  end
end
